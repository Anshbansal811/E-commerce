{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _this = this,\n    _jsxFileName = \"D:\\\\Web\\\\E-commerce\\\\pages\\\\cart.js\",\n    _s = $RefreshSig$();\n\nimport React from \"react\";\nvar __jsx = React.createElement;\nimport baseUrl from '../helpers/baseUrl';\nimport { parseCookies } from 'nookies';\nimport cookie from 'js-cookie';\nimport { useRouter } from 'next/router';\nimport Link from 'next/link';\nimport { useState } from 'react';\nimport StripeCheckout from 'react-stripe-checkout';\n\nvar Cart = function Cart(_ref) {\n  _s();\n\n  var error = _ref.error,\n      products = _ref.products;\n\n  var _parseCookies = parseCookies(),\n      token = _parseCookies.token;\n\n  var router = useRouter();\n\n  var _useState = useState(products),\n      cProducts = _useState[0],\n      setCartProduct = _useState[1];\n\n  var price = 0;\n\n  if (!token) {\n    return __jsx(\"div\", {\n      className: \"center-align\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 17,\n        columnNumber: 13\n      }\n    }, __jsx(\"h3\", {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 18,\n        columnNumber: 17\n      }\n    }, \"please login to view your cart\"), __jsx(Link, {\n      href: \"/login\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 19,\n        columnNumber: 17\n      }\n    }, __jsx(\"a\", {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 19,\n        columnNumber: 37\n      }\n    }, __jsx(\"button\", {\n      className: \"btn #1565c0 blue darken-3\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 19,\n        columnNumber: 40\n      }\n    }, \"Login\"))));\n  }\n\n  if (error) {\n    M.toast({\n      html: error,\n      classes: \"red\"\n    });\n    cookie.remove(\"user\");\n    cookie.remove(\"token\");\n    router.push('/login');\n  }\n\n  var handleRemove = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(pid) {\n      var res, res2;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return fetch(\"\".concat(baseUrl, \"/api/cart\"), {\n                method: \"DELETE\",\n                headers: {\n                  \"Content-Type\": \"application/json\",\n                  \"Authorization\": token\n                },\n                body: JSON.stringify({\n                  productId: pid\n                })\n              });\n\n            case 2:\n              res = _context.sent;\n              _context.next = 5;\n              return res.json();\n\n            case 5:\n              res2 = _context.sent;\n              setCartProduct(res2);\n\n            case 7:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function handleRemove(_x) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var CartItems = function CartItems() {\n    return __jsx(React.Fragment, null, cProducts.map(function (item) {\n      price = price + item.quantity * item.product.price;\n      return __jsx(\"div\", {\n        style: {\n          display: \"flex\",\n          margin: \"20px\"\n        },\n        key: item._id,\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 51,\n          columnNumber: 23\n        }\n      }, __jsx(\"img\", {\n        src: item.product.mediaUrl,\n        style: {\n          width: \"30%\"\n        },\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 52,\n          columnNumber: 27\n        }\n      }), __jsx(\"div\", {\n        style: {\n          marginLeft: \"20px\"\n        },\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 53,\n          columnNumber: 27\n        }\n      }, __jsx(\"h6\", {\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 54,\n          columnNumber: 31\n        }\n      }, item.product.name), __jsx(\"h6\", {\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 55,\n          columnNumber: 31\n        }\n      }, item.quantity, \" x  \\u20B9 \", item.product.price), __jsx(\"button\", {\n        className: \"btn red\",\n        onClick: function onClick() {\n          handleRemove(item.product._id);\n        },\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 56,\n          columnNumber: 31\n        }\n      }, \"remove\")));\n    }));\n  };\n\n  var handleCheckout = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(paymentInfo) {\n      var res, res2;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              console.log(paymentInfo);\n              _context2.next = 3;\n              return fetch(\"\".concat(baseUrl, \"/api/payment\"), {\n                method: \"POST\",\n                headers: {\n                  \"Content-Type\": \"application/json\",\n                  \"Authorization\": token\n                },\n                body: JSON.stringify({\n                  paymentInfo: paymentInfo\n                })\n              });\n\n            case 3:\n              res = _context2.sent;\n              _context2.next = 6;\n              return res.json();\n\n            case 6:\n              res2 = _context2.sent;\n              M.toast({\n                html: res2.mesage,\n                classes: \"green \"\n              });\n              router.push('/');\n\n            case 9:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function handleCheckout(_x2) {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  var TotalPrice = function TotalPrice() {\n    return __jsx(\"div\", {\n      className: \"container\",\n      style: {\n        display: \"flex\",\n        justifyContent: \"space-between\"\n      },\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 84,\n        columnNumber: 13\n      }\n    }, __jsx(\"h5\", {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 85,\n        columnNumber: 17\n      }\n    }, \"total \\u20B9 \", price), products.length != 0 && __jsx(StripeCheckout, {\n      name: \"My store\",\n      amount: price * 100,\n      image: products.length > 0 ? products[0].product.mediaUrl : \"\",\n      currency: \"INR\",\n      shippingAddress: true,\n      billingAddress: true,\n      zipCode: true,\n      stripeKey: \"pk_test_51H6fgDEta3rHzkPYGgIOQZSFrukEzAl71AOnyAUjyGR8uJPDaGfALQYWre4F5g0Quyh9d7PTphh56SmUlhtsQYmd00DZwB9gMj\",\n      token: function token(paymentInfo) {\n        return handleCheckout(paymentInfo);\n      },\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 87,\n        columnNumber: 21\n      }\n    }, __jsx(\"button\", {\n      className: \"btn\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 98,\n        columnNumber: 17\n      }\n    }, \"Checkout\")));\n  };\n\n  return __jsx(\"div\", {\n    className: \"container\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 106,\n      columnNumber: 9\n    }\n  }, __jsx(CartItems, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 107,\n      columnNumber: 11\n    }\n  }), __jsx(TotalPrice, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 108,\n      columnNumber: 11\n    }\n  }));\n};\n\n_s(Cart, \"vX86+fx6ozaSfyLU+cojpoPBTI8=\", false, function () {\n  return [useRouter];\n});\n\n_c = Cart;\nexport var __N_SSP = true;\nexport default Cart;\n\nvar _c;\n\n$RefreshReg$(_c, \"Cart\");","map":{"version":3,"sources":["D:/Web/E-commerce/pages/cart.js"],"names":["baseUrl","parseCookies","cookie","useRouter","Link","useState","StripeCheckout","Cart","error","products","token","router","cProducts","setCartProduct","price","M","toast","html","classes","remove","push","handleRemove","pid","fetch","method","headers","body","JSON","stringify","productId","res","json","res2","CartItems","map","item","quantity","product","display","margin","_id","mediaUrl","width","marginLeft","name","handleCheckout","paymentInfo","console","log","mesage","TotalPrice","justifyContent","length"],"mappings":"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","sourcesContent":["import baseUrl from '../helpers/baseUrl'\r\nimport { parseCookies} from 'nookies'\r\nimport cookie from 'js-cookie'\r\nimport {useRouter} from 'next/router'\r\nimport Link from 'next/link'\r\nimport {useState} from 'react'\r\n\r\nimport StripeCheckout from 'react-stripe-checkout';\r\n\r\nconst Cart  = ({error,products})=>{\r\n    const {token} =  parseCookies()\r\n    const router = useRouter()\r\n    const [cProducts,setCartProduct] = useState(products)\r\n    let price = 0\r\n    if(!token){\r\n        return(\r\n            <div className=\"center-align\">\r\n                <h3>please login to view your cart</h3>\r\n                <Link href=\"/login\"><a><button className=\"btn #1565c0 blue darken-3\">Login</button></a></Link>\r\n            </div>\r\n        )\r\n    }\r\n    if(error){\r\n        M.toast({html:error,classes:\"red\"})\r\n        cookie.remove(\"user\")\r\n        cookie.remove(\"token\")\r\n        router.push('/login')\r\n\r\n    }\r\n    const handleRemove = async (pid)=>{\r\n     const res = await fetch(`${baseUrl}/api/cart`,{\r\n           method:\"DELETE\",\r\n           headers:{\r\n              \"Content-Type\":\"application/json\",\r\n              \"Authorization\":token \r\n           },\r\n           body:JSON.stringify({\r\n               productId:pid\r\n           })\r\n       })\r\n\r\n       const res2 =  await res.json()\r\n       setCartProduct(res2)\r\n    }\r\n    const CartItems = ()=>{\r\n        return(\r\n            <>\r\n              {cProducts.map(item=>{\r\n                price = price + item.quantity * item.product.price\r\n                  return(\r\n                      <div style={{display:\"flex\",margin:\"20px\"}} key={item._id}>\r\n                          <img src={item.product.mediaUrl} style={{width:\"30%\"}}/>\r\n                          <div style={{marginLeft:\"20px\"}}>\r\n                              <h6>{item.product.name}</h6>\r\n                              <h6>{item.quantity} x  ₹ {item.product.price}</h6>\r\n                              <button className=\"btn red\" onClick={()=>{handleRemove(item.product._id)}}>remove</button>\r\n                          </div>\r\n                      </div>\r\n                  )\r\n              })}\r\n            </>\r\n        )\r\n    }\r\n\r\n    const handleCheckout = async (paymentInfo)=>{\r\n        console.log(paymentInfo)\r\n        const res = await fetch(`${baseUrl}/api/payment`,{\r\n            method:\"POST\",\r\n            headers:{\r\n               \"Content-Type\":\"application/json\",\r\n              \"Authorization\":token \r\n            },\r\n            body:JSON.stringify({\r\n                paymentInfo\r\n            })\r\n        })\r\n        const res2 = await res.json()\r\n        M.toast({html: res2.mesage,classes:\"green \"})\r\n        router.push('/')\r\n    }\r\n\r\n    const TotalPrice = ()=>{\r\n        return(\r\n            <div className=\"container\" style={{display:\"flex\",justifyContent:\"space-between\"}}>\r\n                <h5>total ₹ {price}</h5>\r\n                {products.length != 0\r\n                &&  <StripeCheckout\r\n                name=\"My store\"\r\n                amount={price * 100}\r\n                image={products.length > 0 ? products[0].product.mediaUrl:\"\"}\r\n                currency=\"INR\"\r\n                shippingAddress={true}\r\n                billingAddress={true}\r\n                zipCode={true}\r\n                stripeKey=\"pk_test_51H6fgDEta3rHzkPYGgIOQZSFrukEzAl71AOnyAUjyGR8uJPDaGfALQYWre4F5g0Quyh9d7PTphh56SmUlhtsQYmd00DZwB9gMj\"\r\n                token={(paymentInfo)=>handleCheckout(paymentInfo)}\r\n                >\r\n                <button className=\"btn\">Checkout</button>\r\n                </StripeCheckout>\r\n                }\r\n              \r\n            </div>\r\n        )\r\n    }\r\n    return(\r\n        <div className=\"container\" >\r\n          <CartItems />\r\n          <TotalPrice />\r\n        </div>\r\n\r\n    )\r\n}\r\n\r\n\r\nexport async function getServerSideProps(ctx){\r\n    const {token} = parseCookies(ctx)\r\n    if(!token){\r\n        return {\r\n            props:{products:[]}\r\n        }\r\n    }\r\n    const res =  await fetch(`${baseUrl}/api/cart`,{\r\n        headers:{\r\n            \"Authorization\":token\r\n        }\r\n    })\r\n    const products =  await res.json()\r\n    if(products.error){\r\n        return{\r\n            props:{error:products.error}\r\n        }\r\n    }\r\n    console.log(\"products\",products)\r\n    return {\r\n        props:{products}\r\n    }\r\n}\r\n\r\n\r\n\r\nexport default Cart"]},"metadata":{},"sourceType":"module"}